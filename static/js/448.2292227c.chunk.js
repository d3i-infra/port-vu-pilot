(()=>{"use strict";function e(e,o){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=e;const a=e.map((e=>new Date(e).getTime()));let l=null,u=e=>e.toISOString();"auto"===o&&(o=function(e,o){const[n,r]=t(e);let a="hour";r-n>864e5*o&&(a="day");r-n>2592e6*o&&(a="month");r-n>7776e6*o&&(a="quarter");r-n>31536e6*o&&(a="year");return a}(a,n)),"year"===o&&(u=e=>e.getFullYear().toString()),"quarter"===o&&(u=e=>{const t=e.getFullYear().toString(),o=Math.floor(e.getMonth()/3)+1;return"".concat(t,"-Q").concat(o)}),"month"===o&&(u=e=>{const t=e.getFullYear().toString(),o=e.toLocaleString("default",{month:"short"});return"".concat(t,"-").concat(o)}),"day"===o&&(u=e=>{const t=e.getFullYear().toString(),o=e.toLocaleString("default",{month:"short"}),n=e.getDate().toString();return"".concat(t,"-").concat(o,"-").concat(n)}),"hour"===o&&(u=e=>{const t=e.getFullYear().toString(),o=e.toLocaleString("default",{month:"short"}),n=e.getDate().toString(),r=e.toISOString().split("T")[1].split(":")[0];return"".concat(t,"-").concat(o,"-").concat(n," ").concat(r,":00")}),"month_cycle"===o&&(u=e=>new Intl.DateTimeFormat("default",{month:"long"}).format(e),l=[new Date("2000-01-01").getTime(),new Date("2001-01-01").getTime()]),"weekday_cycle"===o&&(u=e=>new Intl.DateTimeFormat("default",{weekday:"long"}).format(e),l=[new Date("2023-11-06").getTime(),new Date("2023-11-13").getTime()]),"hour_cycle"===o&&(u=e=>new Intl.DateTimeFormat("default",{hour:"numeric",hour12:!1}).format(e),l=[new Date("2000-01-01").getTime(),new Date("2000-01-02").getTime()]),r=a.map((e=>u(new Date(e)))),null==l&&(l=t(a));const c=function(e,t,o){const n={},[r,a]=e;let l=0;"year"===t&&(l=314496e5);"quarter"===t&&(l=72576e5);["month","month_cycle"].includes(t)&&(l=24192e5);["day","weekday_cycle"].includes(t)&&(l=864e5);["hour","hour_cycle"].includes(t)&&(l=36e5);if(l>0)for(let u=r;u<=a;u+=l){const e=o(new Date(u));void 0===n[e]&&(n[e]=u)}return n}(l,o,u);return[r,c]}function t(e){let t=e[0],o=e[0];return e.forEach((e=>{e<t&&(t=e),e>o&&(o=e)})),[t,o]}function o(e){return e.split(" ").filter((e=>/\p{L}/giu.test(e)))}function n(e,t){const o=e.head.cells.findIndex((e=>e===t));if(o<0)throw new Error("column ".concat(e.id,".").concat(t," not found"));return e.body.rows.map((e=>e.cells[o]))}function r(e){let t;try{t=new URL(e).hostname.replace(/^www\./,"").replace(/^m\./,"")}catch(o){t=e}return t.trim()}async function a(t,o){if(0===t.body.rows.length)return l(o);const r=function(t,o){const r={},{groupBy:a,xSortable:l}=function(t,o){let r=n(t,o.group.column);if(0===r.length)throw new Error("X column ".concat(t.id,".").concat(o.group.column," not found"));let a=null;void 0!==o.group.dateFormat&&([r,a]=e(r,o.group.dateFormat));if(void 0!==o.group.levels){a={};for(let e=0;e<o.group.levels.length;e++){a[o.group.levels[e]]=e}}return{groupBy:r,xSortable:a}}(t,o),u=t.body.rows.map((e=>e.id)),c=void 0!==o.group.label?o.group.label:o.group.column,s=o.values.some((e=>!0===e.addZeroes));if(s&&null!=l)for(const[e,n]of Object.entries(l))r[e]={sortBy:n,rowIds:{},xLabel:c,xValue:e,values:{},secondAxis:!1,tickerFormat:"default"};for(const e of o.values){var i;const s=void 0!==e.aggregate?e.aggregate:"count";let g="default";"pct"!==s&&"count_pct"!==s||(g="percent");const f=n(t,e.column);if(0===f.length)throw new Error("Y column ".concat(t.id,".").concat(e.column," not found"));const v=void 0!==e.group_by?n(t,e.group_by):null,p=null!==(i=e.addZeroes)&&void 0!==i&&i,y={};for(let t=0;t<u.length;t++){var d;const n=a[t];if(void 0!==o.group.range&&(Number(n)<o.group.range[0]||Number(n)>o.group.range[1]))continue;const i=f[t],p=void 0!==e.label?e.label:e.column,h=null!=v?v[t]:p,w=null!=l?l[n]:a[t];var m;if(void 0===y[h]&&(y[h]={n:0,sum:0}),"count_pct"!==s&&"mean"!==s||(y[h].n+=1),"pct"===s&&(y[h].sum+=null!==(d=Number(i))&&void 0!==d?d:0),void 0===r[n]&&(r[n]={sortBy:w,rowIds:{},xLabel:c,xValue:String(n),values:{},secondAxis:e.secondAxis,tickerFormat:g}),void 0===r[n].rowIds[h]&&(r[n].rowIds[h]=[]),r[n].rowIds[h].push(u[t]),void 0===r[n].values[h]&&(r[n].values[h]=0),"count"!==s&&"count_pct"!==s||(r[n].values[h]+=1),"sum"===s||"mean"===s||"pct"===s)r[n].values[h]+=null!==(m=Number(i))&&void 0!==m?m:0}Object.keys(y).forEach((e=>{for(const t of Object.keys(r)){if(void 0===r[t].values[e]){if(!p)continue;r[t].values[e]=0}"mean"===s&&(r[t].values[e]=Number(r[t].values[e])/y[e].n),"count_pct"===s&&(r[t].values[e]=100*Number(r[t].values[e])/y[e].n),"pct"===s&&(r[t].values[e]=100*Number(r[t].values[e])/y[e].sum)}}))}return console.log(r),r}(t,o);return function(e,t){const o=l(e);for(const n of Object.values(t))for(const e of Object.keys(n.values))void 0===o.yKeys[e]&&(o.yKeys[e]={label:e,secondAxis:n.secondAxis,tickerFormat:n.tickerFormat});return o.data=Object.values(t).sort(((e,t)=>e.sortBy<t.sortBy?-1:t.sortBy<e.sortBy?1:0)).map((e=>{for(const t of Object.keys(e.values))e.values[t]=Math.round(100*e.values[t])/100;return{...e.values,__x:e.xValue,__rowIds:e.rowIds,__sortBy:e.sortBy}})),o}(o,r)}function l(e){return{type:e.type,xKey:{label:void 0!==e.group.label?e.group.label:e.group.column},yKeys:{},data:[]}}async function u(e,t){const a={type:t.type,topTerms:[]};if(0===e.body.rows.length)return a;const l=n(e,t.textColumn),u=function(e,t,n){const a={};for(let u=0;u<e.length;u++){if(null==(null===e||void 0===e?void 0:e[u]))continue;const c=e[u],s=null!=n.tokenize&&n.tokenize?o(c):[c],i=new Set;for(let e of s){var l;"url_domain"===n.extract&&(e=r(e)),void 0===a[e]&&(a[e]={value:0,docFreq:0}),i.has(e)||(a[e].docFreq+=1,i.add(e));const o=null!=t&&null!==(l=Number(t[u]))&&void 0!==l?l:1;isNaN(o)||(a[e].value+=o)}}return a}(l,null!=t.valueColumn?n(e,t.valueColumn):null,t);return a.topTerms=function(e,t,o){return Object.entries(e).map((e=>{let[o,n]=e;const r=n.value,a=Math.log(t/n.docFreq);return{text:o,value:n.value,importance:r*a}})).sort(((e,t)=>t.importance-e.importance)).slice(0,o)}(u,l.length,200),a}self.onmessage=e=>{(async function(e,t){if(void 0===e||void 0===t)throw new Error("Table and visualization are required");if(["line","bar","area"].includes(t.type))return await a(e,t);if(["wordcloud"].includes(t.type))return await u(e,t);throw new Error("Visualization type ".concat(t.type," not supported"))})(e.data.table,e.data.visualization).then((e=>{self.postMessage({status:"success",visualizationData:e})})).catch((e=>{console.error(e),self.postMessage({status:"error",visualizationData:void 0})}))}})();
//# sourceMappingURL=448.2292227c.chunk.js.map